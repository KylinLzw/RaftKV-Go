
PreVote 优化网络分区选举
在Raft算法中，每次Candidate节点想要开启新一轮的选举时，都必须先将自身的Term增加1，然后在集群中广播RequestVote请求。
但我们考虑这样一种情况：在集群中，一个Follower节点A因为物理机掉线等原因与集群产生了网络隔离。
此时A无法收到来自Leader的心跳，因此将自身Term+1，并开启新一轮的选举。一段时间后，A与外界的网络连接恢复，重新加入到集群中。

可能有以下几种可能：
    1. 原集群commit了更多的日志，或Term增加。A重新加入集群后，由于没有足够新的日志或Term较小，它的选举请求将会被绝大多数节点拒绝。 A将会在Leader节点控制下，重新成为Follower。
    2. 原集群没有commit更多的日志且Term没有增加。A重新加入集群后，将可能引发集群中新一轮的选举，并产生一个新的Leader。
在第二种情况中，新的Leader选举是完全没有必要的。考虑到IDC内部网络故障通常发生在极少的机器上（网络隔离），而且很快会恢复（重新加入集群且期间没有日志产生）。
对第二种情况的优化是有必要的，可以采用PreVote机制来规避这种选举。

PreVote的工作机制：
1. 确认节点A将要发起选举，向集群内所有的节点（除了自己）发送一个PreVote消息。该消息携带的内容与RequestVote一致（Term都是A的Term+1），名字仅用于区别两种消息。
2. 同时A更新自身的投票状态（即PreVote发起时，不投票给自己）。 
3. 其他节点收到消息后，判断是否支持该选举请求，并返回结果。判断方式与RequestVote相同，但不更新自身的投票状态。 
4. A统计所有的票数（包括自己的一票），如果确认可以当选，那么A正常发起普通的选举流程。